# 競馬AI: レース結果予測のためのディープラーニングアプローチ

## 1. はじめに
このプロジェクトの目的は、ディープラーニングを学びながら、競馬の予測精度を高め、最終的には予測結果に基づいて実際の賭けで利益を得ることです。現在のAIモデルの予測精度は27%で、これは一番人気の馬が1位になる確率である33%に近いものです。ランダムに馬を選んだ場合の正答率は約8%であることからも、AIが一定の精度を持っていることが分かります。

## 2. 競馬予測における課題と解決策

### 2.1 馬の順位決定は相対的である
競馬では、馬の順位は他の馬との相対的な関係で決まります。つまり、各馬の特徴だけでなく、同じレースに出走する馬の情報も重要です。また、レースによって出走頭数は5頭から18頭まで変動し、この可変長データをどのようにモデルに組み込むかが課題となります。

### 2.2 可変長データの対処法
出走頭数が変動する問題に対処するために、入力データを14頭分に統一しました。出走馬が14頭より少ない場合は、データを複製し、逆に多い場合はデータをマスクして14頭にそろえる方法を採用しています。この方法の利点は、同じレースでも入力順をシャッフルすることで異なるデータとして扱い、学習データを増やすことができる点です。出力も複数生成し、その平均を取ることで精度向上が期待できます。

## 3. 時系列データの扱いと過去レースの参照

### 3.1 過去レース結果の重要性
競馬予測では、各馬の過去レースの結果が重要です。過去のレース条件や対戦相手、順位といったデータを基に、各馬の能力を推し量ることが可能です。このデータは時系列データとして扱えるため、リカレントニューラルネットワーク（RNN）が有効です。

### 3.2 RNNの活用
私のAIモデルでは、馬や騎手の情報を隠れ層に保持し、過去のレースデータを利用するためにRNNを導入しています。この構造により、過去のパフォーマンスデータを基にした予測精度の向上が図れます。

## 4. モデル構造と評価手法

### 4.1 ResNetの採用
モデルの構造には残差ネットワーク（ResNet）を採用しました。ResNetは、恒等写像を行うスキップ接続を持つネットワークで、層が深くなると学習が難しくなる問題を解決します。これにより、深層モデルを効率よく学習させることができ、画像処理分野で大きな成果を上げた技術です。このアーキテクチャを応用することで、競馬AIでも深層学習を効果的に進めることができました。

### 4.2 ListNetの評価関数
競馬の順位は相対的なものなので、回帰や分類とは異なる評価手法が必要です。そのため、作成したAIでは、順位予測に適した「ListNet」と呼ばれる評価関数を実装しました。この関数を使うことで、相対的な順位予測に適応した学習が可能となり、限られたデータで精度が向上しました。

## 5. 結果と今後の展望

### 5.1 予測精度と集合知
この工夫により、AIモデルは23%の予測精度を達成しました。一番人気の馬が実際に1位になる確率は33%ですが、これは「集合知」によるものです。多くの人々がそれぞれ馬の順位を予測し、その結果を集約することで精度が向上します。AIでも同様に、異なるモデルの予測を統合する「アンサンブル学習」を用いることで、さらなる精度向上を図ることができます。これにより現在は27％の予測精度を達成しています。

### 5.2 課題と今後の方向性
現状、AIが1位と予測した馬は人気が高いため、賭けてもリターンが小さく、利益を得ることが難しいです。これを改善するために、現在は深層強化学習を用いて、賭け方自体を学習させる方法を研究しています。最終的には、競馬の予測精度をさらに向上させ、実際に収益を得られるようなAIの開発を目指しています。
